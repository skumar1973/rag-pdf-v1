Chat with PDF 

tech stack

OpenAI
NextJS = React Framework
Clerk = authentication
LangChain = Build RAG with vector DB
Qdrant = VectorDB
Express
BullMQ = Queue for PDF file upload 

Worker = NodeJS client

chunking
OpenAI embedding model

=========
folder
\pdf-rag
 \client
 \server

step 1: create a client using create-next-app

npm i -g pnpm
pnpm dlx create-next-app@latest
pnpm dev

= dev server started 

step 2 : install clerk for authentication

 2.1 Install @clerk/nextjs
	pnpm add @clerk/nextjs
 2.2 Add clerkMiddleware() to your app
	Create a middleware.ts file.

	import { clerkMiddleware } from '@clerk/nextjs/server'

export default clerkMiddleware()

export const config = {
  matcher: [
    // Skip Next.js internals and all static files, unless found in search params
    '/((?!_next|[^?]*\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    // Always run for API routes
    '/(api|trpc)(.*)',
  ],
}

 2.3 Add <ClerkProvider> and Clerk components to your app

	Add the 
<ClerkProvider>
 component to your app's layout. This component provides Clerk's authentication context to your app.

import type { Metadata } from 'next'
import {
  ClerkProvider,
  SignInButton,
  SignUpButton,
  SignedIn,
  SignedOut,
  UserButton,
} from '@clerk/nextjs'
import { Geist, Geist_Mono } from 'next/font/google'
import './globals.css'

const geistSans = Geist({
  variable: '--font-geist-sans',
  subsets: ['latin'],
})

const geistMono = Geist_Mono({
  variable: '--font-geist-mono',
  subsets: ['latin'],
})

export const metadata: Metadata = {
  title: 'Clerk Next.js Quickstart',
  description: 'Generated by create next app',
}

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode
}>) {
  return (
    <ClerkProvider>
      <html lang="en">
        <body className={`${geistSans.variable} ${geistMono.variable} antialiased`}>
          <header className="flex justify-end items-center p-4 gap-4 h-16">
            <SignedOut>
              <SignInButton />
              <SignUpButton>
                <button className="bg-[#6c47ff] text-white rounded-full font-medium text-sm sm:text-base h-10 sm:h-12 px-4 sm:px-5 cursor-pointer">
                  Sign Up
                </button>
              </SignUpButton>
            </SignedOut>
            <SignedIn>
              <UserButton />
            </SignedIn>
          </header>
          {children}
        </body>
      </html>
    </ClerkProvider>
  )
}

 Create your first user

Run your project with the following command:


Visit your app's homepage at http://localhost:3000.

Click "Sign up" in the header and authenticate to create your first user.


step 3: 

create a UPLOAD PDF button

use lucide-rect for upload file icons

pnpm install lucide-react

create file-upload component and use <Upload /> to use lucide upload icon

file-upload.tsx

'use client'

import * as React from 'react';
import {Upload} from 'lucide-react';

const FileUploadComponent:React.FC =() => {
    const handleFileUploadButton = () => {
        const el = document.createElement('input');
        el.setAttribute('type', 'file');
        el.setAttribute('accept', 'application/pdf');
        el.addEventListener('change', (ev)=>{
            //console.log(`ev ${ev}`);
           if (el.files && el.files.length > 0 ) {
                const file = el.files.item(0);
                console.log(file);
            }
        });
        el.click();
    }
    return (
        <div onClick={handleFileUploadButton} className='bg-slate-900 text-white p-4 rounded-lg shadow-2xl'>
            <div className='flex flex-col justify-center items-center'>
            <h3> Upload PDF File</h3>
            <Upload />
            </div>
        </div>
    ); 
}

export default FileUploadComponent



step 5 : create a server react app 
it will use /pdf route and serve client to upload selected pdf file on server storage location




create server project

5.1 pnpm init
 package.json file created.

5.2 install express 4 latest
pnpm i express@4.x

5.3 install dev dependencies for @types/node @types/express@4.x

pnpm i -D @types/node @types/express@4.x

5.4 create a index.js file (server is javascripts only / not type script)

import express from 'express';

const app = express();

app.listen(8000, ()=> console.log('server is running on port 8000'));


5.5 install cors as the frontend and backend is on different port and need cors midllewre to allow.

pnpm i cors

import cors from 'cors'
app.use(cors());

5.6 use multer to upload PDF file on server

pnpm i multer
pnpm i -D @types/multer

creare /pdf route to upload file on server

index.js

import multer from multer;

const upload = multer({ dest: 'uploads/' })

app.post('/upload/pdf', upload.single('pdf'), (req, res)=>{
 return res.json({message:'file uploaded successfully'})
});



6. client side coding for pdf file upload.

7. bullmq for queue , valkey

docker
 valkey

pnpm i bullmq

8. create a worker

9. using langchain create the chunk of the pdf, create the embedding and load that in qdarnt vector store

pnpm add @langchain/qdrant langchain @langchain/community @langchain/openai @langchain/core
pnpm add @langchain/community @langchain/core
pnpm add pdf-parse@1.1.1

import { OpenAIEmbeddings } from "@langchain/openai";
import { QdrantVectorStore } from "@langchain/qdrant";
import { Document } from "@langchain/core/documents";

import { PDFLoader } from "@langchain/community/document_loaders/fs/pdf";


